<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.layout.*?>
<?import javafx.scene.control.*?>
<?import javafx.geometry.Insets?>
<?import com.skilora.framework.components.*?>

<VBox xmlns="http://javafx.com/javafx"
      xmlns:fx="http://javafx.com/fxml"
      fx:controller="com.skilora.finance.controller.FinanceController"
      styleClass="app-content-wrapper" spacing="0"
      style="-fx-background-color: -fx-background;">

    <!-- TOP HEADER BAR -->
    <HBox styleClass="app-topbar" spacing="16" alignment="CENTER_LEFT">
        <Label text="ðŸ’° Finance Management" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: -fx-foreground;"/>
        <Region HBox.hgrow="ALWAYS"/>
        <TLTextField fx:id="mainSearchField" promptText="ðŸ” Rechercher un employÃ© par nom..." prefWidth="350"/>
        <TLButton fx:id="themeToggleBtn" text="ðŸŒ™ Dark" variant="GHOST" onAction="#toggleTheme"/>
    </HBox>

    <!-- TABBED INTERFACE -->
    <TabPane VBox.vgrow="ALWAYS" tabClosingPolicy="UNAVAILABLE" style="-fx-background-color: -fx-background;">
        

        
        <!-- TAB 1: CONTRACTS -->
        <Tab text="ðŸ“‹ Contracts" closable="false">
            <VBox spacing="12" style="-fx-padding: 16; -fx-background-color: -fx-background;">
                
                <TitledPane text="âž• Add Contract" animated="false" collapsible="true" expanded="false"
                           style="-fx-text-fill: -fx-foreground;">
                    <VBox spacing="12" style="-fx-padding: 12;">
                        <GridPane hgap="12" vgap="12">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="25"/>
                                <ColumnConstraints percentWidth="25"/>
                                <ColumnConstraints percentWidth="25"/>
                                <ColumnConstraints percentWidth="25"/>
                            </columnConstraints>
                            
                            <TLComboBox fx:id="contract_userIdCombo" label="Employee" promptText="Select or type employee"
                                      GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                            <TLTextField fx:id="contract_companyIdField" label="Company Name" promptText="Enter company name"
                                       GridPane.columnIndex="1" GridPane.rowIndex="0"/>
                            <TLComboBox fx:id="contract_typeCombo" label="Contract Type"
                                      GridPane.columnIndex="2" GridPane.rowIndex="0"/>
                            <TLTextField fx:id="contract_positionField" label="Position" promptText="Job Position"
                                       GridPane.columnIndex="3" GridPane.rowIndex="0"/>
                            
                            <TLTextField fx:id="contract_salaryField" label="Base Salary" promptText="Salary Amount"
                                       GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                            <TLDatePicker fx:id="contract_startDatePicker" label="Start Date"
                                       GridPane.columnIndex="1" GridPane.rowIndex="1"/>
                            <TLDatePicker fx:id="contract_endDatePicker" label="End Date"
                                       GridPane.columnIndex="2" GridPane.rowIndex="1"/>
                            <TLComboBox fx:id="contract_statusCombo" label="Status"
                                      GridPane.columnIndex="3" GridPane.rowIndex="1"/>
                        </GridPane>

                        <!-- AnciennetÃ© (calcul automatique : Date Fin - Date DÃ©but) -->
                        <Label fx:id="contract_seniorityLabel"
                               text="AnciennetÃ© : â€”"
                               style="-fx-text-fill: -fx-muted-foreground; -fx-font-size: 12px; -fx-font-weight: 600;"/>
                        
                        <Label fx:id="contract_errorLabel" style="-fx-text-fill: -fx-destructive; -fx-font-size: 12px;" wrapText="true" visible="false" managed="false"/>
                        
                        <HBox spacing="8" alignment="CENTER_LEFT">
                            <TLButton fx:id="contract_addBtn" text="âœ… Add Contract" variant="SUCCESS" onAction="#handleAddContract"/>
                            <TLButton fx:id="contract_updateBtn" text="âœï¸ Update" variant="PRIMARY" onAction="#handleUpdateContract"/>
                            <TLButton fx:id="contract_clearBtn" text="ðŸ”„ Clear" variant="OUTLINE" onAction="#handleClearContractForm"/>
                        </HBox>
                    </VBox>
                </TitledPane>
                
                <TitledPane text="ðŸ“Š Contracts List" animated="false" collapsible="true" expanded="true"
                           VBox.vgrow="ALWAYS" maxHeight="Infinity"
                           style="-fx-text-fill: -fx-foreground;">
                    <VBox spacing="8" style="-fx-padding: 12;">
                        <HBox spacing="8">
                            <TLButton text="ðŸ”„ Refresh" variant="OUTLINE" onAction="#handleRefreshContracts"/>
                            <TLButton fx:id="contract_deleteBtn" text="ðŸ—‘ï¸ Delete Selected" variant="DANGER" onAction="#handleDeleteContract"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="contract_countLabel" text="Total: 0" style="-fx-text-fill: -fx-muted-foreground; -fx-font-size: 14px;"/>
                        </HBox>
                        <TableView fx:id="contractTable" VBox.vgrow="ALWAYS" style="-fx-background-color: -fx-card;">
                            <columns>
                                <TableColumn fx:id="contract_idCol" text="ID" prefWidth="50" visible="false"/>
                                <TableColumn fx:id="contract_userCol" text="Employee" prefWidth="150"/>
                                <TableColumn fx:id="contract_companyCol" text="Company" prefWidth="100"/>
                                <TableColumn fx:id="contract_typeCol" text="Type" prefWidth="120"/>
                                <TableColumn fx:id="contract_positionCol" text="Position" prefWidth="150"/>
                                <TableColumn fx:id="contract_salaryCol" text="Salary (TND)" prefWidth="120"/>
                                <TableColumn fx:id="contract_startCol" text="Start Date" prefWidth="120"/>
                                <TableColumn fx:id="contract_endCol" text="End Date" prefWidth="120"/>
                                <TableColumn fx:id="contract_statusCol" text="Status" prefWidth="100"/>
                            </columns>
                        </TableView>
                    </VBox>
                </TitledPane>
            </VBox>
        </Tab>
        
        <!-- TAB 2: BANK ACCOUNTS -->
        <Tab text="ðŸ¦ Bank Accounts" closable="false">
            <VBox spacing="12" style="-fx-padding: 16; -fx-background-color: -fx-background;">
                
                <TitledPane text="âž• Add Bank Account" animated="false" collapsible="true" expanded="false"
                           style="-fx-text-fill: -fx-foreground;">
                    <VBox spacing="12" style="-fx-padding: 12;">
                        <GridPane hgap="12" vgap="12">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="25"/>
                                <ColumnConstraints percentWidth="25"/>
                                <ColumnConstraints percentWidth="25"/>
                                <ColumnConstraints percentWidth="25"/>
                            </columnConstraints>
                            
                            <TLComboBox fx:id="bank_userIdCombo" label="Employee" promptText="Select or type employee"
                                      GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                            <TLTextField fx:id="bank_nameField" label="Bank Name" promptText="Bank Name"
                                       GridPane.columnIndex="1" GridPane.rowIndex="0"/>
                            <TLTextField fx:id="bank_ibanField" label="IBAN" promptText="IBAN"
                                       GridPane.columnIndex="2" GridPane.rowIndex="0"/>
                            <TLTextField fx:id="bank_swiftField" label="SWIFT Code" promptText="SWIFT"
                                       GridPane.columnIndex="3" GridPane.rowIndex="0"/>
                            
                            <TLComboBox fx:id="bank_currencyCombo" label="Currency" promptText="Select or type currency"
                                      GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                            <TLComboBox fx:id="bank_primaryCombo" label="Primary Account"
                                      GridPane.columnIndex="1" GridPane.rowIndex="1"/>
                            <TLComboBox fx:id="bank_verifiedCombo" label="Verified"
                                      GridPane.columnIndex="2" GridPane.rowIndex="1"/>
                        </GridPane>
                        
                        <Label fx:id="bank_errorLabel" style="-fx-text-fill: -fx-destructive; -fx-font-size: 12px;" wrapText="true" visible="false" managed="false"/>
                        
                        <HBox spacing="8" alignment="CENTER_LEFT">
                            <TLButton fx:id="bank_addBtn" text="âœ… Add Account" variant="SUCCESS" onAction="#handleAddBankAccount"/>
                            <TLButton fx:id="bank_updateBtn" text="âœï¸ Update" variant="PRIMARY" onAction="#handleUpdateBankAccount"/>
                            <TLButton fx:id="bank_clearBtn" text="ðŸ”„ Clear" variant="OUTLINE" onAction="#handleClearBankForm"/>
                        </HBox>
                    </VBox>
                </TitledPane>
                
                <TitledPane text="ðŸ“Š Bank Accounts List" animated="false" collapsible="true" expanded="true"
                           VBox.vgrow="ALWAYS" maxHeight="Infinity"
                           style="-fx-text-fill: -fx-foreground;">
                    <VBox spacing="8" style="-fx-padding: 12;">
                        <HBox spacing="8">
                            <TLButton text="ðŸ”„ Refresh" variant="OUTLINE" onAction="#handleRefreshBankAccounts"/>
                            <TLButton fx:id="bank_deleteBtn" text="ðŸ—‘ï¸ Delete Selected" variant="DANGER" onAction="#handleDeleteBankAccount"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="bank_countLabel" text="Total: 0" style="-fx-text-fill: -fx-muted-foreground; -fx-font-size: 14px;"/>
                        </HBox>
                        <TableView fx:id="bankAccountTable" VBox.vgrow="ALWAYS" style="-fx-background-color: -fx-card;">
                            <columns>
                                <TableColumn fx:id="bank_idCol" text="ID" prefWidth="50" visible="false"/>
                                <TableColumn fx:id="bank_userCol" text="Employee" prefWidth="150"/>
                                <TableColumn fx:id="bank_nameCol" text="Bank Name" prefWidth="150"/>
                                <TableColumn fx:id="bank_ibanCol" text="IBAN" prefWidth="180"/>
                                <TableColumn fx:id="bank_swiftCol" text="SWIFT" prefWidth="100"/>
                                <TableColumn fx:id="bank_currencyCol" text="Currency" prefWidth="100"/>
                                <TableColumn fx:id="bank_primaryCol" text="Primary" prefWidth="80"/>
                                <TableColumn fx:id="bank_verifiedCol" text="Verified" prefWidth="80"/>
                            </columns>
                        </TableView>
                    </VBox>
                </TitledPane>
            </VBox>
        </Tab>
        
        <!-- TAB 3: BONUSES -->
        <Tab text="ðŸŽ Bonuses" closable="false">
            <VBox spacing="12" style="-fx-padding: 16; -fx-background-color: -fx-background;">
                
                <TitledPane text="âž• Add Bonus" animated="false" collapsible="true" expanded="false"
                           style="-fx-text-fill: -fx-foreground;">
                    <VBox spacing="12" style="-fx-padding: 12;">
                        <GridPane hgap="12" vgap="12">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="25"/>
                                <ColumnConstraints percentWidth="25"/>
                                <ColumnConstraints percentWidth="50"/>
                            </columnConstraints>
                            
                            <TLComboBox fx:id="bonus_userIdCombo" label="Employee" promptText="Select or type employee"
                                      GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                            <TLTextField fx:id="bonus_amountField" label="Amount" promptText="Bonus Amount"
                                       GridPane.columnIndex="1" GridPane.rowIndex="0"/>
                            <TLTextField fx:id="bonus_reasonField" label="Reason" promptText="Bonus Reason"
                                       GridPane.columnIndex="2" GridPane.rowIndex="0"/>
                        </GridPane>
                        
                        <Label fx:id="bonus_errorLabel" style="-fx-text-fill: -fx-destructive; -fx-font-size: 12px;" wrapText="true" visible="false" managed="false"/>
                        
                        <HBox spacing="8" alignment="CENTER_LEFT">
                            <TLButton fx:id="bonus_addBtn" text="âœ… Add Bonus" variant="SUCCESS" onAction="#handleAddBonus"/>
                            <TLButton fx:id="bonus_updateBtn" text="âœï¸ Update" variant="PRIMARY" onAction="#handleUpdateBonus"/>
                            <TLButton fx:id="bonus_clearBtn" text="ðŸ”„ Clear" variant="OUTLINE" onAction="#handleClearBonusForm"/>
                        </HBox>
                    </VBox>
                </TitledPane>
                
                <TitledPane text="ðŸ“Š Bonuses List" animated="false" collapsible="true" expanded="true"
                           VBox.vgrow="ALWAYS" maxHeight="Infinity"
                           style="-fx-text-fill: -fx-foreground;">
                    <VBox spacing="8" style="-fx-padding: 12;">
                        <HBox spacing="8">
                            <TLButton text="ðŸ”„ Refresh" variant="OUTLINE" onAction="#handleRefreshBonuses"/>
                            <TLButton fx:id="bonus_deleteBtn" text="ðŸ—‘ï¸ Delete Selected" variant="DANGER" onAction="#handleDeleteBonus"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="bonus_countLabel" text="Total: 0" style="-fx-text-fill: -fx-muted-foreground; -fx-font-size: 14px;"/>
                        </HBox>
                        <TableView fx:id="bonusTable" VBox.vgrow="ALWAYS" style="-fx-background-color: -fx-card;">
                            <columns>
                                <TableColumn fx:id="bonus_idCol" text="ID" prefWidth="50" visible="false"/>
                                <TableColumn fx:id="bonus_userCol" text="Employee" prefWidth="200"/>
                                <TableColumn fx:id="bonus_amountCol" text="Amount (TND)" prefWidth="150"/>
                                <TableColumn fx:id="bonus_reasonCol" text="Reason" prefWidth="300"/>
                                <TableColumn fx:id="bonus_dateCol" text="Date Awarded" prefWidth="150"/>
                            </columns>
                        </TableView>
                    </VBox>
                </TitledPane>
            </VBox>
        </Tab>
        
        <!-- TAB 4: PAYSLIPS -->
        <Tab text="ðŸ“„ Payslips" closable="false">
            <VBox spacing="12" style="-fx-padding: 16; -fx-background-color: -fx-background;">
                
                <TitledPane text="âž• Generate Payslip" animated="false" collapsible="true" expanded="false"
                           style="-fx-text-fill: -fx-foreground;">
                    <VBox spacing="12" style="-fx-padding: 12;">
                        <GridPane hgap="12" vgap="12">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="25"/>
                                <ColumnConstraints percentWidth="25"/>
                                <ColumnConstraints percentWidth="25"/>
                                <ColumnConstraints percentWidth="25"/>
                            </columnConstraints>
                            
                            <TLComboBox fx:id="payslip_userIdCombo" label="Employee" promptText="Select or type employee"
                                      GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                            <TLComboBox fx:id="payslip_monthCombo" label="Month"
                                      GridPane.columnIndex="1" GridPane.rowIndex="0"/>
                            <TLComboBox fx:id="payslip_yearCombo" label="Year"
                                      GridPane.columnIndex="2" GridPane.rowIndex="0"/>
                            <TLComboBox fx:id="payslip_currencyCombo" label="Currency" promptText="Select currency"
                                      GridPane.columnIndex="3" GridPane.rowIndex="0"/>
                            
                            <TLTextField fx:id="payslip_baseSalaryField" label="Base Salary" promptText="Amount"
                                       GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                            <TLTextField fx:id="payslip_overtimeField" label="Overtime Hours" promptText="Hours"
                                       GridPane.columnIndex="1" GridPane.rowIndex="1"/>
                            <TLTextField fx:id="payslip_overtimeRateField" label="Overtime Rate" promptText="Per Hour"
                                       GridPane.columnIndex="2" GridPane.rowIndex="1"/>
                            <TLTextField fx:id="payslip_bonusesField" label="Additional Bonuses" promptText="Amount"
                                       GridPane.columnIndex="3" GridPane.rowIndex="1"/>
                            
                            <TLTextField fx:id="payslip_cnssField" label="CNSS Deduction" promptText="Auto-calculated"
                                       GridPane.columnIndex="0" GridPane.rowIndex="2"/>
                            <TLTextField fx:id="payslip_irppField" label="IRPP Tax" promptText="Auto-calculated"
                                       GridPane.columnIndex="1" GridPane.rowIndex="2"/>
                            <TLTextField fx:id="payslip_otherDeductionsField" label="Other Deductions" promptText="Amount"
                                       GridPane.columnIndex="2" GridPane.rowIndex="2"/>
                            <TLComboBox fx:id="payslip_statusCombo" label="Status"
                                      GridPane.columnIndex="3" GridPane.rowIndex="2"/>
                        </GridPane>
                        
                        <HBox spacing="8" style="-fx-background-color: -fx-muted; -fx-padding: 12; -fx-border-radius: 4; -fx-background-radius: 4;">
                            <VBox spacing="4" HBox.hgrow="ALWAYS">
                                <Label text="ðŸ’° Gross Salary:" style="-fx-text-fill: -fx-muted-foreground; -fx-font-size: 12px;"/>
                                <Label fx:id="payslip_grossLabel" text="0.00 TND" style="-fx-text-fill: -fx-foreground; -fx-font-size: 18px; -fx-font-weight: bold;"/>
                            </VBox>
                            <VBox spacing="4" HBox.hgrow="ALWAYS">
                                <Label text="âž– Total Deductions:" style="-fx-text-fill: -fx-muted-foreground; -fx-font-size: 12px;"/>
                                <Label fx:id="payslip_deductionsLabel" text="0.00 TND" style="-fx-text-fill: -fx-destructive; -fx-font-size: 18px; -fx-font-weight: bold;"/>
                            </VBox>
                            <VBox spacing="4" HBox.hgrow="ALWAYS">
                                <Label text="âœ… Net Salary:" style="-fx-text-fill: -fx-muted-foreground; -fx-font-size: 12px;"/>
                                <Label fx:id="payslip_netLabel" text="0.00 TND" style="-fx-text-fill: -fx-foreground; -fx-font-size: 20px; -fx-font-weight: bold;"/>
                            </VBox>
                        </HBox>
                        
                        <Label fx:id="payslip_errorLabel" style="-fx-text-fill: -fx-destructive; -fx-font-size: 12px;" wrapText="true" visible="false" managed="false"/>
                        
                        <HBox spacing="8" alignment="CENTER_LEFT">
                            <TLButton fx:id="payslip_calculateBtn" text="ðŸ§® CALCULATE" variant="PRIMARY" onAction="#handleCalculatePayslip" style="-fx-font-weight: bold; -fx-font-size: 14px;"/>
                            <TLButton fx:id="payslip_addBtn" text="âœ… Save Payslip" variant="SUCCESS" onAction="#handleAddPayslip"/>
                            <TLButton fx:id="payslip_updateBtn" text="âœï¸ Update" variant="PRIMARY" onAction="#handleUpdatePayslip"/>
                            <TLButton fx:id="payslip_pdfBtn" text="ðŸ“„ Export PDF" variant="OUTLINE" onAction="#handleExportPayslipPDF"/>
                            <TLButton fx:id="payslip_clearBtn" text="ðŸ”„ Clear" variant="OUTLINE" onAction="#handleClearPayslipForm"/>
                        </HBox>
                    </VBox>
                </TitledPane>
                
                <TitledPane text="ðŸ“Š Payslips History" animated="false" collapsible="true" expanded="true"
                           VBox.vgrow="ALWAYS" maxHeight="Infinity"
                           style="-fx-text-fill: -fx-foreground;">
                    <VBox spacing="8" style="-fx-padding: 12;">
                        <HBox spacing="8">
                            <TLButton text="ðŸ”„ Refresh" variant="OUTLINE" onAction="#handleRefreshPayslips"/>
                            <TLButton fx:id="payslip_deleteBtn" text="ðŸ—‘ï¸ Delete Selected" variant="DANGER" onAction="#handleDeletePayslip"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="payslip_countLabel" text="Total: 0" style="-fx-text-fill: -fx-muted-foreground; -fx-font-size: 14px;"/>
                        </HBox>
                        <TableView fx:id="payslipTable" VBox.vgrow="ALWAYS" style="-fx-background-color: -fx-card;">
                            <columns>
                                <TableColumn fx:id="payslip_idCol" text="ID" prefWidth="50" visible="false"/>
                                <TableColumn fx:id="payslip_userCol" text="Employee" prefWidth="150"/>
                                <TableColumn fx:id="payslip_periodCol" text="Period" prefWidth="120"/>
                                <TableColumn fx:id="payslip_baseCol" text="Base" prefWidth="100"/>
                                <TableColumn fx:id="payslip_overtimeCol" text="Overtime" prefWidth="100"/>
                                <TableColumn fx:id="payslip_bonusCol" text="Bonuses" prefWidth="100"/>
                                <TableColumn fx:id="payslip_grossCol" text="Gross" prefWidth="120"/>
                                <TableColumn fx:id="payslip_deductCol" text="Deductions" prefWidth="120"/>
                                <TableColumn fx:id="payslip_netCol" text="Net" prefWidth="120"/>
                                <TableColumn fx:id="payslip_statusCol" text="Status" prefWidth="100"/>
                            </columns>
                        </TableView>
                    </VBox>
                </TitledPane>
            </VBox>
        </Tab>

        <!-- TAB 5: REPORTS & TOOLS -->
        <Tab text="ðŸ“Š Reports &amp; Outils" closable="false">
            <ScrollPane fitToWidth="true" style="-fx-background-color: -fx-background; -fx-background: -fx-background;">
                <VBox spacing="20" style="-fx-padding: 24; -fx-background-color: -fx-background;">

                    <!-- â•â•â• SECTION HEADER â•â•â• -->
                    <VBox spacing="4">
                        <Label text="ðŸ“Š Rapports &amp; Outils Financiers"
                               style="-fx-font-size: 22px; -fx-font-weight: bold; -fx-text-fill: -fx-foreground;"/>
                        <Label text="GÃ©nÃ©rez des rapports dÃ©taillÃ©s et calculez les taxes en temps rÃ©el."
                               style="-fx-font-size: 13px; -fx-text-fill: -fx-muted-foreground;"/>
                    </VBox>

                    <!-- â•â•â• SECTION 1: RAPPORT EMPLOYÃ‰ â•â•â• -->
                    <VBox spacing="0" style="-fx-background-color: -fx-card; -fx-border-color: -fx-border; -fx-border-width: 1; -fx-border-radius: 10; -fx-background-radius: 10;">

                        <!-- Card Header -->
                        <HBox spacing="12" alignment="CENTER_LEFT"
                              style="-fx-padding: 16 20 14 20; -fx-border-color: transparent transparent -fx-border transparent; -fx-border-width: 1;">
                            <Label text="ðŸ“‘" style="-fx-font-size: 20px;"/>
                            <VBox spacing="2">
                                <Label text="Rapport EmployÃ© Complet"
                                       style="-fx-font-size: 15px; -fx-font-weight: bold; -fx-text-fill: -fx-foreground;"/>
                                <Label text="PDF incluant contrats, comptes bancaires, primes et bulletins de paie."
                                       style="-fx-font-size: 11px; -fx-text-fill: -fx-muted-foreground;"/>
                            </VBox>
                        </HBox>

                        <!-- Card Body -->
                        <VBox spacing="16" style="-fx-padding: 20;">
                            <HBox spacing="16" alignment="BOTTOM_LEFT">
                                <VBox spacing="6" HBox.hgrow="ALWAYS">
                                    <Label text="SÃ©lectionner l'employÃ©"
                                           style="-fx-font-size: 12px; -fx-font-weight: bold; -fx-text-fill: -fx-foreground;"/>
                                    <TLComboBox fx:id="report_employeeCombo" promptText="ðŸ”  Choisir un employÃ©..."/>
                                </VBox>
                                <TLButton fx:id="report_generateBtn"
                                          text="ðŸ“„  GÃ©nÃ©rer le rapport PDF"
                                          variant="PRIMARY"
                                          onAction="#handleGenerateEmployeeReport"
                                          style="-fx-font-size: 13px; -fx-font-weight: bold;"/>
                            </HBox>

                            <!-- Info box -->
                            <HBox spacing="10" alignment="CENTER_LEFT"
                                  style="-fx-background-color: rgba(59,130,246,0.1); -fx-padding: 10 14 10 14; -fx-border-radius: 6; -fx-background-radius: 6; -fx-border-color: rgba(59,130,246,0.3); -fx-border-width: 1;">
                                <Label text="â„¹ï¸" style="-fx-font-size: 15px;"/>
                                <Label text="Le rapport PDF contiendra tous les dÃ©tails financiers de l'employÃ© sÃ©lectionnÃ© (contrats actifs, comptes bancaires, primes et historique des bulletins de paie)."
                                       wrapText="true" HBox.hgrow="ALWAYS"
                                       style="-fx-font-size: 11px; -fx-text-fill: -fx-muted-foreground;"/>
                            </HBox>
                        </VBox>
                    </VBox>

                    <!-- â•â•â• SECTION 2: CALCULATEUR DE TAXES TUNISIENNES â•â•â• -->
                    <VBox spacing="0" style="-fx-background-color: -fx-card; -fx-border-color: -fx-border; -fx-border-width: 1; -fx-border-radius: 10; -fx-background-radius: 10;">

                        <!-- Card Header -->
                        <HBox spacing="12" alignment="CENTER_LEFT"
                              style="-fx-padding: 16 20 14 20; -fx-border-color: transparent transparent -fx-border transparent; -fx-border-width: 1;">
                            <Label text="ðŸ§®" style="-fx-font-size: 20px;"/>
                            <VBox spacing="2" HBox.hgrow="ALWAYS">
                                <Label text="Calculateur de Taxes Tunisiennes (CNSS + IRPP)"
                                       style="-fx-font-size: 15px; -fx-font-weight: bold; -fx-text-fill: -fx-foreground;"/>
                                <Label text="Calcul automatique CNSS (9.18%) + IRPP (26%) selon la loi tunisienne."
                                       style="-fx-font-size: 11px; -fx-text-fill: -fx-muted-foreground;"/>
                            </VBox>
                            <!-- Badge info taux -->
                            <HBox spacing="6">
                                <Label text="CNSS 9.18%"
                                       style="-fx-background-color: rgba(234,179,8,0.15); -fx-text-fill: #ca8a04; -fx-padding: 4 8 4 8; -fx-background-radius: 20; -fx-font-size: 11px; -fx-font-weight: bold;"/>
                                <Label text="IRPP 26%"
                                       style="-fx-background-color: rgba(239,68,68,0.15); -fx-text-fill: #dc2626; -fx-padding: 4 8 4 8; -fx-background-radius: 20; -fx-font-size: 11px; -fx-font-weight: bold;"/>
                            </HBox>
                        </HBox>

                        <!-- Card Body -->
                        <VBox spacing="20" style="-fx-padding: 20;">

                            <!-- Inputs row -->
                            <HBox spacing="16" alignment="BOTTOM_LEFT">
                                <VBox spacing="6" HBox.hgrow="ALWAYS">
                                    <Label text="Salaire Brut"
                                           style="-fx-font-size: 12px; -fx-font-weight: bold; -fx-text-fill: -fx-foreground;"/>
                                    <TLTextField fx:id="tax_grossField" promptText="Ex: 2500.00"/>
                                </VBox>
                                <VBox spacing="6">
                                    <Label text="Devise"
                                           style="-fx-font-size: 12px; -fx-font-weight: bold; -fx-text-fill: -fx-foreground;"/>
                                    <TLComboBox fx:id="tax_currencyCombo" promptText="TND"/>
                                </VBox>
                                <TLButton fx:id="tax_calculateBtn"
                                          text="âš¡  Calculer maintenant"
                                          variant="PRIMARY"
                                          onAction="#handleCalculateTax"
                                          style="-fx-font-size: 13px; -fx-font-weight: bold;"/>
                            </HBox>

                            <!-- â•â•â• RÃ©sultats du calcul (cartes KPI) â•â•â• -->
                            <VBox fx:id="tax_resultsBox" spacing="12" visible="false" managed="false">

                                <!-- SÃ©parateur titre rÃ©sultats -->
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Label text="RÃ©sultat du calcul"
                                           style="-fx-font-size: 13px; -fx-font-weight: bold; -fx-text-fill: -fx-foreground;"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Label fx:id="tax_employeeLabelResult" text=""
                                           style="-fx-font-size: 11px; -fx-text-fill: -fx-muted-foreground;"/>
                                </HBox>

                                <!-- Cartes rÃ©sultats: ligne 1 -->
                                <HBox spacing="12">

                                    <!-- Salaire Brut -->
                                    <VBox spacing="6" HBox.hgrow="ALWAYS"
                                          style="-fx-background-color: rgba(59,130,246,0.1); -fx-border-color: rgba(59,130,246,0.4); -fx-border-width: 1; -fx-border-radius: 8; -fx-background-radius: 8; -fx-padding: 14 16 14 16;">
                                        <HBox spacing="8" alignment="CENTER_LEFT">
                                            <Label text="ðŸ’°" style="-fx-font-size: 16px;"/>
                                            <Label text="Salaire Brut"
                                                   style="-fx-font-size: 11px; -fx-text-fill: #3b82f6; -fx-font-weight: bold;"/>
                                        </HBox>
                                        <Label fx:id="tax_grossResult" text="---"
                                               style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #3b82f6;"/>
                                    </VBox>

                                    <!-- CNSS -->
                                    <VBox spacing="6" HBox.hgrow="ALWAYS"
                                          style="-fx-background-color: rgba(234,179,8,0.1); -fx-border-color: rgba(234,179,8,0.4); -fx-border-width: 1; -fx-border-radius: 8; -fx-background-radius: 8; -fx-padding: 14 16 14 16;">
                                        <HBox spacing="8" alignment="CENTER_LEFT">
                                            <Label text="ðŸ¥" style="-fx-font-size: 16px;"/>
                                            <Label text="CNSS (9.18%)"
                                                   style="-fx-font-size: 11px; -fx-text-fill: #ca8a04; -fx-font-weight: bold;"/>
                                        </HBox>
                                        <Label fx:id="tax_cnssResult" text="---"
                                               style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #ca8a04;"/>
                                    </VBox>

                                    <!-- IRPP -->
                                    <VBox spacing="6" HBox.hgrow="ALWAYS"
                                          style="-fx-background-color: rgba(239,68,68,0.1); -fx-border-color: rgba(239,68,68,0.4); -fx-border-width: 1; -fx-border-radius: 8; -fx-background-radius: 8; -fx-padding: 14 16 14 16;">
                                        <HBox spacing="8" alignment="CENTER_LEFT">
                                            <Label text="ðŸ›ï¸" style="-fx-font-size: 16px;"/>
                                            <Label text="IRPP (26%)"
                                                   style="-fx-font-size: 11px; -fx-text-fill: #dc2626; -fx-font-weight: bold;"/>
                                        </HBox>
                                        <Label fx:id="tax_irppResult" text="---"
                                               style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #dc2626;"/>
                                    </VBox>
                                </HBox>

                                <!-- Cartes rÃ©sultats: ligne 2 -->
                                <HBox spacing="12">

                                    <!-- Total dÃ©ductions -->
                                    <VBox spacing="6" HBox.hgrow="ALWAYS"
                                          style="-fx-background-color: rgba(168,85,247,0.1); -fx-border-color: rgba(168,85,247,0.4); -fx-border-width: 1; -fx-border-radius: 8; -fx-background-radius: 8; -fx-padding: 14 16 14 16;">
                                        <HBox spacing="8" alignment="CENTER_LEFT">
                                            <Label text="âž–" style="-fx-font-size: 16px;"/>
                                            <Label text="Total DÃ©ductions"
                                                   style="-fx-font-size: 11px; -fx-text-fill: #a855f7; -fx-font-weight: bold;"/>
                                        </HBox>
                                        <Label fx:id="tax_totalDeductResult" text="---"
                                               style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #a855f7;"/>
                                    </VBox>

                                    <!-- Salaire Net (carte mise en avant) -->
                                    <VBox spacing="6" HBox.hgrow="ALWAYS"
                                          style="-fx-background-color: rgba(34,197,94,0.15); -fx-border-color: rgba(34,197,94,0.5); -fx-border-width: 2; -fx-border-radius: 8; -fx-background-radius: 8; -fx-padding: 14 16 14 16;">
                                        <HBox spacing="8" alignment="CENTER_LEFT">
                                            <Label text="âœ…" style="-fx-font-size: 16px;"/>
                                            <Label text="SALAIRE NET"
                                                   style="-fx-font-size: 12px; -fx-text-fill: #16a34a; -fx-font-weight: bold;"/>
                                            <Label text="â­ Ã€ PERCEVOIR"
                                                   style="-fx-font-size: 10px; -fx-text-fill: #16a34a; -fx-background-color: rgba(34,197,94,0.2); -fx-padding: 2 6 2 6; -fx-background-radius: 10;"/>
                                        </HBox>
                                        <Label fx:id="tax_netResult" text="---"
                                               style="-fx-font-size: 26px; -fx-font-weight: bold; -fx-text-fill: #16a34a;"/>
                                    </VBox>

                                    <!-- Taux effectif -->
                                    <VBox spacing="6" HBox.hgrow="ALWAYS"
                                          style="-fx-background-color: rgba(100,116,139,0.1); -fx-border-color: rgba(100,116,139,0.3); -fx-border-width: 1; -fx-border-radius: 8; -fx-background-radius: 8; -fx-padding: 14 16 14 16;">
                                        <HBox spacing="8" alignment="CENTER_LEFT">
                                            <Label text="ðŸ“ˆ" style="-fx-font-size: 16px;"/>
                                            <Label text="Taux d'imposition effectif"
                                                   style="-fx-font-size: 11px; -fx-text-fill: -fx-muted-foreground; -fx-font-weight: bold;"/>
                                        </HBox>
                                        <Label fx:id="tax_rateResult" text="---"
                                               style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: -fx-foreground;"/>
                                    </VBox>
                                </HBox>

                                <!-- Barre de progression dÃ©ductions vs net -->
                                <VBox spacing="6"
                                      style="-fx-background-color: -fx-muted; -fx-border-color: -fx-border; -fx-border-width: 1; -fx-border-radius: 8; -fx-background-radius: 8; -fx-padding: 14 16 14 16;">
                                    <HBox spacing="8" alignment="CENTER_LEFT">
                                        <Label text="ðŸ“‹" style="-fx-font-size: 14px;"/>
                                        <Label text="RÃ©capitulatif dÃ©taillÃ©"
                                               style="-fx-font-size: 12px; -fx-font-weight: bold; -fx-text-fill: -fx-foreground;"/>
                                    </HBox>
                                    <Label fx:id="tax_summaryLabel" text=""
                                           wrapText="true"
                                           style="-fx-font-size: 12px; -fx-text-fill: -fx-muted-foreground; -fx-font-family: 'Consolas', 'Monospaced';"/>
                                </VBox>
                            </VBox>

                            <!-- Hint quand pas encore calculÃ© -->
                            <VBox fx:id="tax_hintBox" spacing="8" alignment="CENTER"
                                  style="-fx-background-color: rgba(100,116,139,0.05); -fx-border-color: rgba(100,116,139,0.2); -fx-border-width: 1; -fx-border-style: dashed; -fx-border-radius: 8; -fx-background-radius: 8; -fx-padding: 32;">
                                <Label text="ðŸ§®"
                                       style="-fx-font-size: 36px; -fx-text-fill: -fx-muted-foreground;"/>
                                <Label text="Entrez un salaire brut et cliquez sur Calculer"
                                       style="-fx-font-size: 14px; -fx-text-fill: -fx-muted-foreground;"/>
                                <Label text="Le dÃ©tail complet CNSS + IRPP + Salaire Net s'affichera ici."
                                       style="-fx-font-size: 12px; -fx-text-fill: -fx-muted-foreground;"/>
                            </VBox>

                            <!-- Champ cachÃ© pour compatibilitÃ© avec le controller existant -->
                            <TextArea fx:id="tax_resultArea" visible="false" managed="false" editable="false"/>
                        </VBox>
                    </VBox>

                    <!-- â•â•â• SECTION 3: INFO TAUX LÃ‰GAUX TUNISIENS â•â•â• -->
                    <VBox spacing="0" style="-fx-background-color: -fx-card; -fx-border-color: -fx-border; -fx-border-width: 1; -fx-border-radius: 10; -fx-background-radius: 10;">
                        <HBox spacing="12" alignment="CENTER_LEFT"
                              style="-fx-padding: 14 20 12 20; -fx-border-color: transparent transparent -fx-border transparent; -fx-border-width: 1;">
                            <Label text="âš–ï¸" style="-fx-font-size: 18px;"/>
                            <Label text="BarÃ¨me LÃ©gal Tunisien en Vigueur"
                                   style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: -fx-foreground;"/>
                        </HBox>
                        <HBox spacing="12" style="-fx-padding: 16;">

                            <!-- CNSS -->
                            <VBox spacing="8" HBox.hgrow="ALWAYS"
                                  style="-fx-background-color: rgba(234,179,8,0.08); -fx-border-color: rgba(234,179,8,0.3); -fx-border-width: 1; -fx-border-radius: 8; -fx-background-radius: 8; -fx-padding: 14;">
                                <Label text="ðŸ¥  CNSS â€” Caisse Nationale de SÃ©curitÃ© Sociale"
                                       style="-fx-font-size: 12px; -fx-font-weight: bold; -fx-text-fill: #ca8a04;"/>
                                <Label text="9.18% du salaire brut"
                                       style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: -fx-foreground;"/>
                                <Label text="Couverture: retraite, maladie, accidents de travail"
                                       style="-fx-font-size: 11px; -fx-text-fill: -fx-muted-foreground;" wrapText="true"/>
                            </VBox>

                            <!-- IRPP -->
                            <VBox spacing="8" HBox.hgrow="ALWAYS"
                                  style="-fx-background-color: rgba(239,68,68,0.08); -fx-border-color: rgba(239,68,68,0.3); -fx-border-width: 1; -fx-border-radius: 8; -fx-background-radius: 8; -fx-padding: 14;">
                                <Label text="ðŸ›ï¸  IRPP â€” ImpÃ´t sur le Revenu des Personnes Physiques"
                                       style="-fx-font-size: 12px; -fx-font-weight: bold; -fx-text-fill: #dc2626;"/>
                                <Label text="26% sur (Brut âˆ’ CNSS)"
                                       style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: -fx-foreground;"/>
                                <Label text="Taux simplifiÃ©. Le taux rÃ©el dÃ©pend du barÃ¨me progressif."
                                       style="-fx-font-size: 11px; -fx-text-fill: -fx-muted-foreground;" wrapText="true"/>
                            </VBox>

                            <!-- Total -->
                            <VBox spacing="8" HBox.hgrow="ALWAYS"
                                  style="-fx-background-color: rgba(168,85,247,0.08); -fx-border-color: rgba(168,85,247,0.3); -fx-border-width: 1; -fx-border-radius: 8; -fx-background-radius: 8; -fx-padding: 14;">
                                <Label text="ðŸ“Š  Charge totale indicative"
                                       style="-fx-font-size: 12px; -fx-font-weight: bold; -fx-text-fill: #a855f7;"/>
                                <Label text="â‰ˆ 33% du salaire brut"
                                       style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: -fx-foreground;"/>
                                <Label text="CNSS + IRPP combinÃ©s (estimation moyen)"
                                       style="-fx-font-size: 11px; -fx-text-fill: -fx-muted-foreground;" wrapText="true"/>
                            </VBox>
                        </HBox>
                    </VBox>

                </VBox>
            </ScrollPane>
        </Tab>
        
    </TabPane>

</VBox>
