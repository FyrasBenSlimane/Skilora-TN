<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.layout.*?>
<?import javafx.scene.control.*?>
<?import javafx.geometry.Insets?>
<?import com.skilora.framework.components.*?>
<?import com.skilora.framework.components.TLSeparator?>

<VBox xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="com.skilora.user.controller.ForgotPasswordController"
      spacing="24"
      alignment="CENTER"
      style="-fx-background-color: transparent;">
    
    <padding><Insets top="48" right="32" bottom="48" left="32"/></padding>
    
    <!-- Card Container -->
    <TLCard maxWidth="480" alignment="CENTER">
        <VBox spacing="0" alignment="CENTER">
            <padding><Insets top="36" right="40" bottom="36" left="40"/></padding>
            
            <!-- ===== Step Progress Indicator ===== -->
            <HBox fx:id="stepIndicator" spacing="0" alignment="CENTER" style="-fx-padding: 0 0 28px 0;">
                <!-- Step 1 -->
                <VBox alignment="CENTER" spacing="4">
                    <StackPane fx:id="step1Circle" minWidth="32" minHeight="32" maxWidth="32" maxHeight="32"
                               style="-fx-background-color: -fx-primary; -fx-background-radius: 16;">
                        <Label fx:id="step1Label" text="1" style="-fx-font-size: 13px; -fx-font-weight: 700; -fx-text-fill: -fx-primary-foreground;"/>
                    </StackPane>
                    <Label fx:id="step1Text" text="Email" style="-fx-font-size: 11px; -fx-text-fill: -fx-foreground;"/>
                </VBox>
                <!-- Connector 1-2 -->
                <Region fx:id="connector1" prefWidth="60" prefHeight="2" maxHeight="2"
                        style="-fx-background-color: -fx-muted; -fx-background-radius: 1;"
                        VBox.vgrow="NEVER"/>
                <!-- Step 2 -->
                <VBox alignment="CENTER" spacing="4">
                    <StackPane fx:id="step2Circle" minWidth="32" minHeight="32" maxWidth="32" maxHeight="32"
                               style="-fx-background-color: -fx-muted; -fx-background-radius: 16;">
                        <Label fx:id="step2Label" text="2" style="-fx-font-size: 13px; -fx-font-weight: 700; -fx-text-fill: -fx-muted-foreground;"/>
                    </StackPane>
                    <Label fx:id="step2Text" text="Verify" style="-fx-font-size: 11px; -fx-text-fill: -fx-muted-foreground;"/>
                </VBox>
                <!-- Connector 2-3 -->
                <Region fx:id="connector2" prefWidth="60" prefHeight="2" maxHeight="2"
                        style="-fx-background-color: -fx-muted; -fx-background-radius: 1;"
                        VBox.vgrow="NEVER"/>
                <!-- Step 3 -->
                <VBox alignment="CENTER" spacing="4">
                    <StackPane fx:id="step3Circle" minWidth="32" minHeight="32" maxWidth="32" maxHeight="32"
                               style="-fx-background-color: -fx-muted; -fx-background-radius: 16;">
                        <Label fx:id="step3Label" text="3" style="-fx-font-size: 13px; -fx-font-weight: 700; -fx-text-fill: -fx-muted-foreground;"/>
                    </StackPane>
                    <Label fx:id="step3Text" text="Reset" style="-fx-font-size: 11px; -fx-text-fill: -fx-muted-foreground;"/>
                </VBox>
            </HBox>
            
            <!-- ===== Header ===== -->
            <VBox spacing="6" alignment="CENTER" style="-fx-padding: 0 0 24px 0;">
                <Label fx:id="iconLabel" text="" style="-fx-font-size: 40px;"/>
                <Label fx:id="titleLabel" text="" styleClass="h2"/>
                <Label fx:id="subtitleLabel" text="" 
                       styleClass="text-muted" wrapText="true" alignment="CENTER"
                       style="-fx-max-width: 320;"/>
            </VBox>
            
            <!-- ===== Main Content Area (swappable) ===== -->
            <VBox fx:id="contentArea" spacing="16" alignment="CENTER" style="-fx-min-width: 380;">
                
                <!-- Email/OTP Input -->
                <VBox spacing="8">
                    <Label fx:id="fieldLabel" text="Email" styleClass="label"/>
                    <TLTextField fx:id="emailField" promptText="your@email.com" prefWidth="380"/>
                </VBox>
                
                <!-- Password field (hidden by default, shown in step 3) -->
                <VBox fx:id="passwordContainer" spacing="8" visible="false" managed="false">
                    <TLPasswordField fx:id="newPasswordField" label="New Password" promptText="Enter new password"/>
                    <TLPasswordField fx:id="confirmPasswordField" label="Confirm Password" promptText="Confirm new password"/>
                </VBox>
                
                <!-- Feedback messages -->
                <Label fx:id="errorLabel" text="" styleClass="text-destructive" visible="false" managed="false"
                       wrapText="true" style="-fx-padding: 4 0 0 0;"/>
                <Label fx:id="successLabel" text="" style="-fx-text-fill: -fx-green; -fx-padding: 4 0 0 0;" 
                       visible="false" managed="false" wrapText="true"/>
                
                <!-- Loading spinner -->
                <HBox fx:id="loadingBox" spacing="8" alignment="CENTER" visible="false" managed="false"
                      style="-fx-padding: 8 0 0 0;">
                    <ProgressIndicator fx:id="loadingSpinner" prefWidth="20" prefHeight="20"/>
                    <Label fx:id="loadingLabel" text="Sending..." styleClass="text-muted" style="-fx-font-size: 13px;"/>
                </HBox>
            </VBox>
            
            <!-- ===== Actions ===== -->
            <VBox spacing="10" style="-fx-padding: 20 0 0 0;">
                <TLButton fx:id="sendBtn" text="Send code" variant="PRIMARY" 
                         onAction="#handleSendReset" maxWidth="Infinity"/>
                <TLButton fx:id="backBtn" text="Back to login" variant="GHOST" 
                         onAction="#handleBack" maxWidth="Infinity"
                         style="-fx-font-size: 13px;"/>
            </VBox>
            
            <!-- ===== Resend Section ===== -->
            <VBox fx:id="resendSection" spacing="8" alignment="CENTER" style="-fx-padding: 16 0 0 0;"
                  visible="false" managed="false">
                <TLSeparator/>
                <HBox spacing="8" alignment="CENTER" style="-fx-padding: 8 0 0 0;">
                    <Label fx:id="notReceivedLabel" text="Didn't receive the email?" styleClass="text-muted"
                           style="-fx-font-size: 13px;"/>
                    <TLButton fx:id="resendBtn" text="Resend" variant="OUTLINE" size="SM"
                             onAction="#handleResend" disable="true"/>
                </HBox>
            </VBox>
        </VBox>
    </TLCard>
</VBox>
