
================================================================================
                              S K I L O R A
          Documentation Technique â€” API et MÃ©tiers AvancÃ©s
                     Module CommunautÃ© (Module 6)
================================================================================

Projet      : Skilora â€” Plateforme de Formation et Recrutement (Tunisie)
Technologie : JavaFX 21 + MySQL + APIs REST externes
Architecture: MVC + Singleton + DAO Pattern
Date        : FÃ©vrier 2026

================================================================================
                         TABLE DES MATIÃˆRES
================================================================================

  1.  Vue d'ensemble du projet
  2.  Architecture et structure des fichiers
  3.  API 1 â€” Traduction multilingue (MyMemory)
  4.  API 2 â€” Upload d'images dans le cloud (Cloudinary)
  5.  API 3 â€” Envoi d'emails (Gmail SMTP)
  6.  MÃ©tier avancÃ© 1 â€” SystÃ¨me de mentions @utilisateur
  7.  MÃ©tier avancÃ© 2 â€” Notifications en temps rÃ©el (Polling)
  8.  MÃ©tier avancÃ© 3 â€” DÃ©tection automatique de langue
  9.  MÃ©tier avancÃ© 4 â€” Recherche globale multi-entitÃ©
  10. MÃ©tier avancÃ© 5 â€” Dashboard statistiques (rÃ´le-based)
  11. RÃ©capitulatif â€” OÃ¹ trouver chaque bloc de code


================================================================================
  1. VUE D'ENSEMBLE DU PROJET
================================================================================

Skilora est une plateforme JavaFX de formation et recrutement destinÃ©e au
marchÃ© tunisien. Le Module 6 â€” CommunautÃ© intÃ¨gre 3 APIs REST externes et
plusieurs mÃ©tiers avancÃ©s pour offrir une expÃ©rience riche aux utilisateurs.


--- Les 3 APIs externes intÃ©grÃ©es ---

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ API         â”‚ Service                  â”‚ RÃ´le                                   â”‚ ClÃ© API ?    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ MyMemory    â”‚ TranslationService       â”‚ Traduction dynamique (fr/en/ar)        â”‚ Non (gratuit)â”‚
  â”‚ Cloudinary  â”‚ CloudinaryUploadService  â”‚ Upload d'images vers le cloud          â”‚ Upload presetâ”‚
  â”‚ Gmail SMTP  â”‚ EmailService             â”‚ Envoi d'emails OTP (mot de passe)      â”‚ Mdp d'appli  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


--- Les mÃ©tiers avancÃ©s ---

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ MÃ©tier                   â”‚ Service                      â”‚ Description                          â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Mentions @user           â”‚ MentionService               â”‚ AutocomplÃ©tion + notifications       â”‚
  â”‚ Notifications temps rÃ©el â”‚ CommunityNotificationService â”‚ Polling DB + badges live + toasts    â”‚
  â”‚ DÃ©tection de langue      â”‚ TranslationService           â”‚ Heuristiques (accents, mots, regex)  â”‚
  â”‚ Recherche globale        â”‚ SearchService                â”‚ Multi-entitÃ© (posts, msg, events...) â”‚
  â”‚ Dashboard stats          â”‚ DashboardStatsService        â”‚ Statistiques par rÃ´le (admin/user)   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
  2. ARCHITECTURE ET STRUCTURE DES FICHIERS
================================================================================

--- Pattern MVC + Singleton + DAO ---

  CommunityController  â†’  Services (Singleton)  â†’  APIs externes / MySQL
                           Entity (POJO)  +  Enums

Chaque service utilise le pattern Singleton (Double-Checked Locking) pour
garantir une seule instance thread-safe dans toute l'application.


--- Arborescence des fichiers (Module CommunautÃ©) ---

  src/main/java/com/skilora/community/
  â”œâ”€â”€ controller/
  â”‚   â””â”€â”€ CommunityController.java         â† ContrÃ´leur principal (3 372 lignes)
  â”‚
  â”œâ”€â”€ service/
  â”‚   â”œâ”€â”€ TranslationService.java           â† API MyMemory (604 lignes)
  â”‚   â”œâ”€â”€ CloudinaryUploadService.java      â† API Cloudinary (318 lignes)
  â”‚   â”œâ”€â”€ EmailService.java                 â† API Gmail SMTP (174 lignes)
  â”‚   â”œâ”€â”€ MentionService.java               â† Mentions @user (250 lignes)
  â”‚   â”œâ”€â”€ CommunityNotificationService.java â† Notifications temps rÃ©el (194 lignes)
  â”‚   â”œâ”€â”€ SearchService.java                â† Recherche globale (299 lignes)
  â”‚   â”œâ”€â”€ DashboardStatsService.java        â† Dashboard stats (246 lignes)
  â”‚   â”œâ”€â”€ PostService.java                  â† CRUD Posts + Likes + Commentaires (531 lignes)
  â”‚   â”œâ”€â”€ BlogService.java                  â† CRUD Blog (208 lignes)
  â”‚   â”œâ”€â”€ EventService.java                 â† CRUD Ã‰vÃ©nements + RSVP (275 lignes)
  â”‚   â”œâ”€â”€ GroupService.java                 â† CRUD Groupes + Membres (278 lignes)
  â”‚   â”œâ”€â”€ ConnectionService.java            â† Connexions / Invitations (260 lignes)
  â”‚   â”œâ”€â”€ MessagingService.java             â† Messagerie privÃ©e (309 lignes)
  â”‚   â”œâ”€â”€ NotificationService.java          â† Notifications DB (154 lignes)
  â”‚   â””â”€â”€ ReportService.java                â† Signalements (132 lignes)
  â”‚
  â”œâ”€â”€ entity/
  â”‚   â”œâ”€â”€ Post.java, PostComment.java, BlogArticle.java
  â”‚   â”œâ”€â”€ Event.java, EventRsvp.java
  â”‚   â”œâ”€â”€ CommunityGroup.java, GroupMember.java
  â”‚   â”œâ”€â”€ Connection.java, Conversation.java, Message.java
  â”‚   â”œâ”€â”€ Notification.java, Report.java, Company.java
  â”‚
  â””â”€â”€ enums/
      â”œâ”€â”€ PostType.java         (STATUS, ARTICLE_SHARE, JOB_SHARE, ACHIEVEMENT, SUCCESS_STORY)
      â”œâ”€â”€ ConnectionStatus.java (PENDING, ACCEPTED, REJECTED, BLOCKED)
      â”œâ”€â”€ EventStatus.java      (UPCOMING, ONGOING, COMPLETED, CANCELLED)
      â””â”€â”€ EventType.java        (MEETUP, WEBINAR, WORKSHOP, CONFERENCE, NETWORKING)


--- Pattern Singleton (Double-Checked Locking) ---

  UtilisÃ© dans TOUS les 15 services. Voici le pattern :

  Le constructeur est privÃ©. Une variable statique volatile "instance" contient
  la seule instance. La mÃ©thode getInstance() vÃ©rifie d'abord si instance est
  null (sans synchronisation), puis si oui, entre dans un bloc synchronized et
  re-vÃ©rifie (double check) avant de crÃ©er l'instance. Cela garantit :
    - Une seule instance dans toute l'application
    - Thread-safe (pas de crÃ©ation en double)
    - Performance (pas de synchronized Ã  chaque appel)


================================================================================
  3. API 1 â€” TRADUCTION MULTILINGUE (MyMemory)
================================================================================

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  API       : MyMemory Translated                                           â•‘
â•‘  URL       : https://api.mymemory.translated.net/get                       â•‘
â•‘  Type      : API REST gratuite (pas de clÃ© API requise)                    â•‘
â•‘  Format    : JSON                                                          â•‘
â•‘  Limites   : 5 000 caractÃ¨res/requÃªte, 10 000 requÃªtes/jour               â•‘
â•‘  Langues   : FranÃ§ais (fr), Anglais (en), Arabe (ar)                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Fichier : src/main/java/com/skilora/community/service/TranslationService.java
  Taille  : 604 lignes


--- 3.1 RÃ´le ---

  Le TranslationService permet de traduire dynamiquement le contenu des posts
  entre franÃ§ais, anglais et arabe. L'utilisateur clique sur un bouton
  "Traduire" sous chaque post et choisit la langue cible. La traduction est
  effectuÃ©e via l'API MyMemory avec plusieurs couches de fallback.


--- 3.2 StratÃ©gie multi-couche (5 niveaux) ---

  Le service essaie 5 stratÃ©gies dans l'ordre. Si une Ã©choue, il passe Ã  la
  suivante. L'application ne plante jamais grÃ¢ce Ã  ce systÃ¨me de fallback.

  [1] Cache LRU  â†’  [2] Dictionnaire local  â†’  [3] API MyMemory
                         â†’  [4] 2-Ã©tapes via anglais  â†’  [5] Texte original

  Couche 1 â€” Cache LRU (LinkedHashMap, max 100 entrÃ©es)
    ClÃ© du cache : "texte|langueSource|langueCible"
    Si dÃ©jÃ  traduit avant â†’ retour instantanÃ©, 0 requÃªte rÃ©seau.

  Couche 2 â€” Dictionnaire local (HashMap statique)
    Contient des mots courants en fr/en/ar.
    Fiable Ã  100%, ne dÃ©pend pas d'Internet.

  Couche 3 â€” API MyMemory (traduction machine dynamique)
    Appel REST GET avec paramÃ¨tre &mt=1 pour forcer la traduction machine.
    Timeout de 8 secondes. Score TM minimum : 0.3.

  Couche 4 â€” Traduction 2-Ã©tapes via anglais
    Pour les paires faibles (ex: frâ†”ar), on fait : fr â†’ en â†’ ar.
    L'anglais sert de langue pivot pour amÃ©liorer la qualitÃ©.

  Couche 5 â€” Fallback : texte original
    Si tout Ã©choue, le texte original est retournÃ© tel quel.


--- 3.3 MÃ©thode principale : translate() ---

  Fichier : TranslationService.java, ligne 213

  ParamÃ¨tres :
    - text       : le texte Ã  traduire
    - sourceLang : langue dÃ©tectÃ©e du texte ("fr", "en", ou "ar")
    - targetLang : langue cible choisie par l'utilisateur

  Comportement :
    1. Si text est null ou vide â†’ retourne text
    2. Si sourceLang == targetLang :
       a. Essaie de trouver le mot dans le dictionnaire avec une autre source
       b. Si pas trouvÃ©, essaie l'API avec fr, en, ar comme source alternative
       c. Si rien ne marche â†’ retourne text (c'est vraiment la mÃªme langue)
    3. VÃ©rifie le cache LRU (clÃ© = "text|source|cible")
    4. VÃ©rifie le dictionnaire local
    5. Appelle l'API MyMemory â†’ si rÃ©sultat valide, le met en cache
    6. Si la paire n'est pas via anglais, tente la traduction 2-Ã©tapes
    7. En dernier recours, retourne le texte original


--- 3.4 Appel API : callMyMemoryAPI() ---

  Fichier : TranslationService.java, ligne 335

  Ã‰tapes :
    1. Nettoyer le texte (supprimer emojis via stripEmojisAndSpecialChars)
    2. Encoder le texte pour URL (URLEncoder.encode)
    3. Construire l'URL :
         https://api.mymemory.translated.net/get?q=TEXTE&langpair=fr|en&mt=1
    4. Ouvrir une connexion HTTP GET avec timeout 8 secondes
    5. Lire la rÃ©ponse JSON
    6. Extraire responseData.translatedText
    7. Parcourir le tableau "matches" pour trouver le meilleur rÃ©sultat :
       - PrioritÃ© aux traductions MT (machine translation, created-by = "MT!")
       - Puis les TM (mÃ©moire traducteur) avec score >= 0.3
       - Sinon accepter la traduction primaire

  Exemple de requÃªte :
    GET https://api.mymemory.translated.net/get?q=bonjour&langpair=fr|en&mt=1

  Exemple de rÃ©ponse JSON :
    {
      "responseData": {
        "translatedText": "Hello",
        "match": 1.0
      },
      "matches": [
        { "translation": "Hello", "match": 1.0, "created-by": "MT!" },
        { "translation": "Good morning", "match": 0.85, "created-by": "" }
      ]
    }


--- 3.5 Validation : isValidTranslation() ---

  Fichier : TranslationService.java, ligne 558

  Cette mÃ©thode vÃ©rifie que la traduction retournÃ©e par l'API est valide :
    - N'est pas null ou vide
    - N'est pas identique au texte original (nettoyÃ©)
    - N'est pas trop longue (max 5x la longueur originale) sauf si < 200 chars
    - Ne contient pas de messages d'erreur MyMemory

  Le texte est nettoyÃ© (emojis supprimÃ©s, minuscules) avant comparaison
  pour Ã©viter les faux positifs dus aux caractÃ¨res spÃ©ciaux.


--- 3.6 IntÃ©gration dans le contrÃ´leur ---

  Fichier : CommunityController.java

  Instanciation (ligne 94) :
    Le TranslationService est instanciÃ© via getInstance() dans les attributs
    du contrÃ´leur.

  Bouton "Traduire" (ligne 721-725) :
    Chaque carte de post contient un bouton "ğŸŒ Traduire" de type GHOST.
    Au clic, il appelle showTranslationMenu().

  Menu de traduction (ligne 2988) :
    showTranslationMenu() crÃ©e un popup avec 3 options :
      - ğŸ‡«ğŸ‡· FranÃ§ais
      - ğŸ‡¬ğŸ‡§ English
      - ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©

    Au clic sur une langue :
      1. DÃ©tecte la langue du texte via translationService.detectLanguage()
      2. Lance un Thread sÃ©parÃ© (pour ne pas bloquer l'UI)
      3. Appelle translationService.translate(text, sourceLang, targetLang)
      4. Met Ã  jour le Label du post via Platform.runLater()
      5. PrÃ©fixe le texte traduit avec "ğŸŒ [FR/EN/AR]"


================================================================================
  4. API 2 â€” UPLOAD D'IMAGES DANS LE CLOUD (Cloudinary)
================================================================================

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  API           : Cloudinary                                                â•‘
â•‘  URL           : https://api.cloudinary.com/v1_1/skilora/image/upload      â•‘
â•‘  Type          : Upload non signÃ© (unsigned) via multipart/form-data       â•‘
â•‘  CLOUD_NAME    : skilora                                                   â•‘
â•‘  UPLOAD_PRESET : skilora_unsigned                                          â•‘
â•‘  Limites       : 10 MB par image                                           â•‘
â•‘  Formats       : jpg, jpeg, png, gif, webp, bmp                            â•‘
â•‘  Retour        : URL HTTPS publique de l'image hÃ©bergÃ©e                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Fichier : src/main/java/com/skilora/community/service/CloudinaryUploadService.java
  Taille  : 318 lignes


--- 4.1 RÃ´le ---

  Quand un utilisateur crÃ©e un post avec une image, le fichier est uploadÃ©
  vers Cloudinary (CDN cloud). L'API retourne une URL HTTPS publique qui est
  stockÃ©e en base de donnÃ©es. Si l'upload Ã©choue (pas d'internet), le fichier
  est sauvegardÃ© localement en fallback dans le dossier data/uploads/.


--- 4.2 Ã‰tapes de l'upload ---

  [FileChooser UI] â†’ [Validation] â†’ [POST multipart/form-data] â†’ [URL HTTPS]
                                         â†“ (si erreur)
                                    [Sauvegarde locale]

  Ã‰tape 1 â€” Validation (lignes 122-133)
    - Le fichier existe-t-il ? (file != null && file.exists())
    - Taille <= 10 MB ? (file.length() > 10 * 1024 * 1024 â†’ erreur)
    - Extension autorisÃ©e ? (jpg, jpeg, png, gif, webp, bmp)
    - Si une validation Ã©choue â†’ RuntimeException avec message descriptif

  Ã‰tape 2 â€” Construction du body multipart (lignes 135-145)
    - GÃ©nÃ©rer un boundary unique : "----CloudinaryBoundary" + UUID.randomUUID()
    - Le body multipart contient 3 parties :
      Partie 1 : Content-Disposition: form-data; name="file"; filename="photo.jpg"
                 â†’ Contenu binaire du fichier image
      Partie 2 : Content-Disposition: form-data; name="upload_preset"
                 â†’ Valeur : "skilora_unsigned"
      Partie 3 : Content-Disposition: form-data; name="folder"
                 â†’ Valeur : "skilora/community"

  Ã‰tape 3 â€” RequÃªte POST HTTP (lignes 147-185)
    - URL : https://api.cloudinary.com/v1_1/skilora/image/upload
    - MÃ©thode : POST
    - Header : Content-Type: multipart/form-data; boundary=BOUNDARY
    - Ã‰criture du body dans le OutputStream de la connexion
    - Lecture de la rÃ©ponse

  Ã‰tape 4 â€” Parsing de la rÃ©ponse JSON (lignes 187-200)
    - Extraire le champ "secure_url" de la rÃ©ponse JSON
    - RÃ©sultat : "https://res.cloudinary.com/skilora/image/upload/v.../image.jpg"
    - Cette URL est retournÃ©e et stockÃ©e dans le champ image_url du post

  Ã‰tape 5 â€” Fallback local si erreur (lignes 244-267)
    - Si l'API Cloudinary Ã©choue (pas d'internet, timeout, etc.)
    - Le fichier est copiÃ© dans data/uploads/ avec un nom unique (UUID)
    - L'URL locale (file:///C:/...) est retournÃ©e Ã  la place


--- 4.3 MÃ©thode saveLocally() ---

  Fichier : CloudinaryUploadService.java, ligne 244

  1. CrÃ©ation du dossier data/uploads/ (s'il n'existe pas)
  2. GÃ©nÃ©ration d'un nom unique : UUID.randomUUID().substring(0, 8) + extension
  3. Copie du fichier original vers le dossier uploads
  4. Retour du chemin absolu sous forme d'URI file:///


--- 4.4 IntÃ©gration dans le contrÃ´leur ---

  Fichier : CommunityController.java

  Instanciation (ligne 95) :
    CloudinaryUploadService instanciÃ© via getInstance()

  Bouton Upload (lignes 316-350) :
    1. Un bouton "ğŸ“· Upload Image" est ajoutÃ© au dialogue de crÃ©ation de post
    2. Au clic â†’ FileChooser s'ouvre (filtre : *.jpg, *.png, *.gif, *.webp)
    3. Quand l'utilisateur sÃ©lectionne un fichier :
       a. Un Thread sÃ©parÃ© est lancÃ©
       b. cloudinaryService.uploadImage(file) est appelÃ©
       c. L'URL retournÃ©e est mise dans le champ imageUrlField
       d. L'aperÃ§u de l'image est affichÃ© dans le dialogue

  CrÃ©ation du post (lignes 380-431) :
    L'URL de l'image (Cloudinary ou locale) est incluse dans l'INSERT SQL
    du post avec le contenu texte.


================================================================================
  5. API 3 â€” ENVOI D'EMAILS (Gmail SMTP)
================================================================================

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Protocole       : SMTP avec TLS 1.2                                       â•‘
â•‘  Serveur         : smtp.gmail.com:587                                      â•‘
â•‘  Authentification: Variables d'environnement                               â•‘
â•‘                    SKILORA_MAIL_EMAIL = adresse Gmail                       â•‘
â•‘                    SKILORA_MAIL_PASSWORD = mot de passe d'application       â•‘
â•‘  Utilisation     : Envoi de codes OTP (rÃ©cupÃ©ration mot de passe)          â•‘
â•‘  Format email    : HTML professionnel avec template Skilora                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Fichier : src/main/java/com/skilora/community/service/EmailService.java
  Taille  : 174 lignes


--- 5.1 RÃ´le ---

  Quand un utilisateur demande la rÃ©cupÃ©ration de son mot de passe, un code
  OTP Ã  6 chiffres est envoyÃ© par email via le serveur SMTP de Gmail. L'email
  est au format HTML avec un template professionnel brandÃ© Skilora.


--- 5.2 Ã‰tapes de l'envoi ---

  [Utilisateur oublie mdp] â†’ [GÃ©nÃ©rer OTP 6 chiffres] â†’ [SMTP Gmail TLS]
                                                          â†’ [Email HTML reÃ§u]

  L'envoi est ASYNCHRONE grÃ¢ce Ã  CompletableFuture : l'interface ne se bloque
  pas pendant l'envoi de l'email.


--- 5.3 MÃ©thode sendOtpEmail() ---

  Fichier : EmailService.java, ligne 60

  Signature : CompletableFuture<Boolean> sendOtpEmail(String toEmail, String otpCode)

  1. CompletableFuture.supplyAsync() lance l'envoi dans un thread du pool
  2. Construit le sujet : "Votre code de vÃ©rification Skilora"
  3. Construit le body HTML via buildOtpEmailBody(otpCode)
  4. Appelle sendEmail() pour l'envoi SMTP
  5. Retourne true si succÃ¨s, false si erreur


--- 5.4 MÃ©thode sendEmail() ---

  Fichier : EmailService.java, ligne 77

  Configuration SMTP (Properties) :
    mail.smtp.auth           = true
    mail.smtp.starttls.enable = true
    mail.smtp.host           = smtp.gmail.com
    mail.smtp.port           = 587
    mail.smtp.ssl.protocols  = TLSv1.2

  Authentification :
    Utilise javax.mail.Authenticator avec les variables d'environnement :
    - fromEmail    = System.getenv("SKILORA_MAIL_EMAIL")
    - fromPassword = System.getenv("SKILORA_MAIL_PASSWORD")

  CrÃ©ation du message :
    - From    : fromEmail, nom affichÃ© "Skilora Support"
    - To      : adresse de l'utilisateur
    - Subject : "Votre code de vÃ©rification Skilora"
    - Body    : HTML (multipart/alternative)
    - Envoi   : Transport.send(message)


--- 5.5 Template HTML de l'email (buildOtpEmailBody) ---

  Fichier : EmailService.java, ligne 118

  L'email OTP contient :
    - BanniÃ¨re avec logo Skilora
    - Message d'accueil
    - Le code OTP en gros caractÃ¨res (style monospace, couleur bleue)
    - Instruction "Ce code expire dans 10 minutes"
    - Footer avec mention "Ne partagez jamais ce code"
    - Design responsive (mobile-friendly)


--- 5.6 Configuration requise ---

  âš  IMPORTANT : Il faut dÃ©finir 2 variables d'environnement :

  1. SKILORA_MAIL_EMAIL = adresse Gmail du compte expÃ©diteur
  2. SKILORA_MAIL_PASSWORD = mot de passe d'APPLICATION Gmail
     (PAS le mot de passe normal du compte Gmail !)

  Pour gÃ©nÃ©rer un mot de passe d'application :
    â†’ Google Account â†’ SÃ©curitÃ© â†’ Connexion Ã  Google
    â†’ Mots de passe des applications â†’ GÃ©nÃ©rer

  Sans ces variables, l'envoi d'email ne fonctionnera pas et une erreur
  sera loguÃ©e dans la console.


================================================================================
  6. MÃ‰TIER AVANCÃ‰ 1 â€” SYSTÃˆME DE MENTIONS @UTILISATEUR
================================================================================

  Fichier : src/main/java/com/skilora/community/service/MentionService.java
  Taille  : 250 lignes


--- 6.1 RÃ´le ---

  Similaire Ã  Twitter/LinkedIn : quand un utilisateur tape @ dans le champ
  de texte d'un post, un popup d'autocomplÃ©tion apparaÃ®t avec les noms
  d'utilisateurs correspondants. AprÃ¨s publication, les utilisateurs
  mentionnÃ©s reÃ§oivent une notification.


--- 6.2 Flux complet ---

  [1. Tape @J] â†’ [2. SQL LIKE '%J%'] â†’ [3. Popup autocomplÃ©tion]
       â†’ [4. SÃ©lection â†’ @Jean_Dupont] â†’ [5. Notification envoyÃ©e]


--- 6.3 Regex de dÃ©tection des mentions ---

  Fichier : MentionService.java, ligne 51

  Pattern : @(\w+(?:_\w+)*)

  Explication :
    @        â†’ le caractÃ¨re arobase (dÃ©clencheur)
    \w+      â†’ un ou plusieurs caractÃ¨res de mot (lettres, chiffres, _)
    (?:_\w+)*â†’ suivi optionnellement de _mot (pour les noms composÃ©s)

  Exemples valides   : @Jean, @Jean_Dupont, @admin_2024
  Exemples invalides : @ (seul), @Jean Dupont (espace coupe la mention)


--- 6.4 Classe interne UserMention ---

  Fichier : MentionService.java, ligne 73

  Chaque utilisateur trouvÃ© est reprÃ©sentÃ© par un UserMention :
    - userId   : ID en base de donnÃ©es (int)
    - fullName : nom complet "Jean Dupont" (String)
    - handle   : nom sans espaces "Jean_Dupont" (espaces â†’ underscores)

  Le handle est gÃ©nÃ©rÃ© automatiquement :
    fullName.trim().replaceAll("\\s+", "_")


--- 6.5 Recherche SQL pour autocomplÃ©tion ---

  Fichier : MentionService.java, ligne 104

  MÃ©thode : searchUsers(String query, int limit)

  RequÃªte SQL :
    SELECT id, full_name FROM users
    WHERE full_name LIKE '%query%'
       OR REPLACE(full_name, ' ', '_') LIKE '%query%'
    ORDER BY full_name ASC
    LIMIT limit

  Le REPLACE dans le WHERE permet de chercher Ã  la fois "Jean_D" et "Jean D".
  Le LIMIT est gÃ©nÃ©ralement 5 Ã  8 rÃ©sultats max.


--- 6.6 Extraction des mentions d'un texte ---

  Fichier : MentionService.java, ligne 148

  MÃ©thode : extractMentions(String text)

  Utilise le MENTION_PATTERN (regex ci-dessus) avec un Matcher pour
  trouver toutes les occurrences de @handle dans le texte.
  Retourne une List<String> des handles trouvÃ©s (sans le @).


--- 6.7 Traitement aprÃ¨s publication ---

  Fichier : MentionService.java, ligne 205

  MÃ©thode : processMentions(String text, int authorId, int postId)

  Ã‰tapes :
    1. extractMentions(text) â†’ ["Jean_Dupont", "Marie"]
    2. Pour chaque handle :
       a. findUserIdByHandle(handle) â†’ requÃªte SQL pour trouver l'ID
       b. Si userId > 0 ET userId != authorId (ne pas se notifier soi-mÃªme)
       c. createMentionNotification(userId, authorId, postId)

  La notification est insÃ©rÃ©e en base :
    INSERT INTO notifications (user_id, type, message, reference_id, is_read, created_date)
    VALUES (?, 'MENTION', 'Vous avez Ã©tÃ© mentionnÃ© dans un post', ?, FALSE, NOW())


--- 6.8 IntÃ©gration dans le contrÃ´leur ---

  Fichier : CommunityController.java

  AutocomplÃ©tion (lignes 3127-3232) :
    La mÃ©thode setupMentionDetection(textArea, dialog) est appelÃ©e lors de
    la crÃ©ation du dialogue de post. Elle ajoute un listener sur le texte
    qui dÃ©tecte chaque frappe :

    1. Ã€ chaque modification du texte :
       a. Trouver le dernier @ avant la position du curseur
       b. Extraire la requÃªte aprÃ¨s @ (ce que l'utilisateur a tapÃ©)
       c. Si la requÃªte fait >= 1 caractÃ¨re :
          - Appeler mentionService.searchUsers(query, 5) dans un thread
          - Afficher un popup Popup avec la liste des utilisateurs
          - Chaque entrÃ©e montre le nom complet
       d. Au clic sur un utilisateur :
          - Remplacer @query par @Handle dans le texte
          - Fermer le popup

  Traitement des mentions (ligne 413) :
    AprÃ¨s crÃ©ation du post dans la base de donnÃ©es :
    mentionService.processMentions(text, currentUser.getId(), postId)


================================================================================
  7. MÃ‰TIER AVANCÃ‰ 2 â€” NOTIFICATIONS EN TEMPS RÃ‰EL (POLLING)
================================================================================

  Fichier : src/main/java/com/skilora/community/service/CommunityNotificationService.java
  Taille  : 194 lignes


--- 7.1 RÃ´le ---

  Ce service interroge la base de donnÃ©es toutes les 6 secondes pour dÃ©tecter :
    - Nouveaux messages non lus
    - Nouvelles demandes de connexion (invitations)

  Il met Ã  jour en temps rÃ©el les badges sur les onglets et affiche des toasts
  (notifications visuelles temporaires).


--- 7.2 Architecture du polling ---

  [JavaFX Timeline] â†’ [Thread arriÃ¨re-plan] â†’ [SQL COUNT unread]
       â†’ [Platform.runLater] â†’ [Badge + Toast]

  Le cycle se rÃ©pÃ¨te toutes les 6 secondes indÃ©finiment (Timeline.INDEFINITE).


--- 7.3 CrÃ©ation du poller ---

  Fichier : CommunityNotificationService.java, ligne 62

  Constructeur : CommunityNotificationService(int userId, int intervalSeconds)
    - userId : l'ID de l'utilisateur connectÃ©
    - intervalSeconds : intervalle de polling (minimum 3 secondes)

  CrÃ©e une Timeline JavaFX :
    - KeyFrame avec Duration.seconds(interval)
    - Action : appeler pollNotifications()
    - CycleCount : Animation.INDEFINITE (boucle infinie)

  MÃ©thodes start() et stop() :
    - start() : lance un premier poll immÃ©diat + dÃ©marre la Timeline
    - stop()  : arrÃªte la Timeline et met isRunning = false


--- 7.4 Logique de polling : pollNotifications() ---

  Fichier : CommunityNotificationService.java, ligne 155

  1. CrÃ©e un Thread daemon (meurt avec l'application)
  2. Dans ce thread :
     a. Appelle MessagingService.getInstance().getUnreadCount(userId)
     b. Appelle ConnectionService.getInstance().getPendingCount(userId)
  3. Puis dans Platform.runLater (thread JavaFX) :
     a. Compare les nouveaux counts avec les anciens
     b. Si le count a changÃ© â†’ dÃ©clenche le callback correspondant
     c. Met Ã  jour lastUnreadMessages / lastPendingConnections

  L'utilisation de Thread daemon + Platform.runLater garantit que :
    - Les requÃªtes SQL ne bloquent pas l'interface
    - Les modifications de l'UI sont faites sur le thread JavaFX (obligatoire)


--- 7.5 Callbacks ---

  Le service expose 2 callbacks BiConsumer<Integer, Integer> :

  1. onUnreadMessagesChanged(oldCount, newCount)
     â†’ DÃ©clenchÃ© quand le nombre de messages non lus change

  2. onPendingConnectionsChanged(oldCount, newCount)
     â†’ DÃ©clenchÃ© quand le nombre d'invitations en attente change


--- 7.6 IntÃ©gration dans le contrÃ´leur ---

  Fichier : CommunityController.java, lignes 129-175

  Initialisation (ligne 131) :
    notificationService = new CommunityNotificationService(currentUser.getId(), 6)

  Callback messages (lignes 141-150) :
    notificationService.setOnUnreadMessagesChanged((old, new) -> {
        communityTabs.setTabBadge("messages", newCount);    â† Badge visuel
        if (old >= 0 && new > old) {
            showToast("ğŸ“© " + (new - old) + " nouveau(x) message(s)");
        }
    });

  Callback connexions (lignes 155-165) :
    notificationService.setOnPendingConnectionsChanged((old, new) -> {
        communityTabs.setTabBadge("connections", newCount);  â† Badge visuel
        if (old >= 0 && new > old) {
            showToast("ğŸ”” " + (new - old) + " nouvelle(s) invitation(s)");
        }
    });

  DÃ©marrage (ligne 175) :
    notificationService.start();


================================================================================
  8. MÃ‰TIER AVANCÃ‰ 3 â€” DÃ‰TECTION AUTOMATIQUE DE LANGUE
================================================================================

  Fichier : src/main/java/com/skilora/community/service/TranslationService.java
  MÃ©thode : detectLanguage(), lignes 454-541


--- 8.1 RÃ´le ---

  Quand l'utilisateur clique "Traduire", le systÃ¨me doit deviner la langue du
  post AVANT d'appeler l'API de traduction. La mÃ©thode detectLanguage() utilise
  un algorithme heuristique en 6 Ã©tapes.


--- 8.2 Les 6 Ã©tapes de dÃ©tection ---

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Ã‰tape  â”‚ CritÃ¨re                                  â”‚ RÃ©sultat     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 0      â”‚ Nettoyage : supprimer emojis, spÃ©ciaux   â”‚ Texte propre â”‚
  â”‚ 1      â”‚ > 30% de caractÃ¨res arabes (U+0600-06FF) â”‚ â†’ "ar"       â”‚
  â”‚ 2      â”‚ PrÃ©sence d'accents : Ã©, Ã¨, Ãª, Ã§, Ã , Ã¹... â”‚ â†’ "fr"       â”‚
  â”‚ 3      â”‚ Contractions : j'ai, l'homme, c'est, qu' â”‚ â†’ "fr"       â”‚
  â”‚ 4      â”‚ Mot isolÃ© dans dictionnaire franÃ§ais (60+)â”‚ â†’ "fr"       â”‚
  â”‚ 5      â”‚ Mots-outils fr : le, la, de, un, est, je â”‚ â†’ "fr" si â‰¥1 â”‚
  â”‚ 6      â”‚ Mots-outils en : the, is, are, have, withâ”‚ â†’ "en" si â‰¥1 â”‚
  â”‚ DÃ©faut â”‚ Si rien n'est dÃ©tectÃ©                     â”‚ â†’ "fr"       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


--- 8.3 DÃ©tails de chaque Ã©tape ---

  Ã‰tape 0 â€” Nettoyage (stripEmojisAndSpecialChars, ligne 436)
    Regex : [^\p{L}\p{N}\s'-]
    Garde uniquement : lettres (toutes langues), chiffres, espaces,
    apostrophes et tirets. Supprime les emojis, symboles, ponctuation.

  Ã‰tape 1 â€” DÃ©tection arabe
    Compte les caractÃ¨res Unicode dans la plage U+0600-U+06FF (arabe).
    Si > 30% du total des lettres â†’ c'est de l'arabe.

  Ã‰tape 2 â€” Accents franÃ§ais
    Cherche la prÃ©sence de : Ã©, Ã¨, Ãª, Ã«, Ã§, Ã , Ã¢, Ã¹, Ã», Ã´, Ã®, Ã¯
    Un seul accent suffit â†’ c'est du franÃ§ais (ces accents n'existent
    pas en anglais).

  Ã‰tape 3 â€” Contractions franÃ§aises
    Regex : \b[jldcnqs]'\w+
    DÃ©tecte : j'ai, j'aime, l'homme, l'air, d'accord, c'est, n'est,
    qu'est, s'il. Ces contractions sont uniques au franÃ§ais.

  Ã‰tape 4 â€” Dictionnaire de mots isolÃ©s
    Si le texte est un seul mot, il est cherchÃ© dans un Set de 60+ mots
    franÃ§ais courants : bonjour, salut, merci, bonsoir, oui, non, peut-Ãªtre,
    aujourd'hui, demain, hier, travail, formation, etc.

  Ã‰tape 5 â€” Comptage de mots-outils franÃ§ais
    Le texte est dÃ©coupÃ© en mots. Chaque mot est comparÃ© Ã  un Set de
    mots-outils franÃ§ais : le, la, les, de, du, des, un, une, est, sont,
    je, tu, il, nous, vous, ils, et, ou, mais, dans, pour, avec, sur, etc.
    Si au moins 1 mot franÃ§ais trouvÃ© â†’ "fr".

  Ã‰tape 6 â€” Comptage de mots-outils anglais
    MÃªme principe avec les mots anglais : the, is, are, was, were, have,
    has, had, will, would, can, could, this, that, with, from, etc.
    Si au moins 1 mot anglais trouvÃ© ET 0 mot franÃ§ais â†’ "en".

  DÃ©faut â€” Si aucun critÃ¨re n'est satisfait â†’ "fr"
    Le contexte du projet est tunisien, donc le franÃ§ais est plus probable.


================================================================================
  9. MÃ‰TIER AVANCÃ‰ 4 â€” RECHERCHE GLOBALE MULTI-ENTITÃ‰
================================================================================

  Fichier : src/main/java/com/skilora/community/service/SearchService.java
  Taille  : 299 lignes


--- 9.1 RÃ´le ---

  Le SearchService permet de chercher un mot-clÃ© dans 5 types d'entitÃ©s
  simultanÃ©ment : Posts, Messages, Ã‰vÃ©nements, Groupes et Blog.
  Les rÃ©sultats sont fusionnÃ©s et triÃ©s par date dÃ©croissante.


--- 9.2 Architecture ---

  [Mot-clÃ©] â†’ [SQL LIKE x5 tables] â†’ [Fusion + Tri] â†’ [List<SearchResult>]


--- 9.3 EntitÃ©s recherchÃ©es ---

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ EntitÃ©       â”‚ Champs cherchÃ©s         â”‚ SÃ©curitÃ©                         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Posts        â”‚ content                 â”‚ Posts publiÃ©s uniquement         â”‚
  â”‚ Messages     â”‚ content                 â”‚ Conversations de l'user seul.   â”‚
  â”‚ Ã‰vÃ©nements   â”‚ title, description      â”‚ Tous                            â”‚
  â”‚ Groupes      â”‚ name, description       â”‚ Tous                            â”‚
  â”‚ Blog         â”‚ title, content, tags    â”‚ Articles publiÃ©s uniquement     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


--- 9.4 Filtres disponibles ---

  SearchFilter (filtre par type d'entitÃ©) :
    ALL, POSTS, MESSAGES, EVENTS, GROUPS, BLOG

  DateFilter (filtre par pÃ©riode) :
    ALL, TODAY, THIS_WEEK, THIS_MONTH, THIS_YEAR


--- 9.5 MÃ©thode search() ---

  Signature : List<SearchResult> search(String keyword, SearchFilter filter, int userId)

  Comportement :
    1. CrÃ©e une liste vide de SearchResult
    2. PrÃ©pare le pattern SQL : "%" + keyword + "%"
    3. Pour chaque type d'entitÃ© autorisÃ© par le filtre :
       a. ExÃ©cute une requÃªte SELECT ... WHERE ... LIKE ?
       b. CrÃ©e un SearchResult pour chaque ligne retournÃ©e
       c. L'ajoute Ã  la liste
    4. Trie la liste complÃ¨te par date dÃ©croissante
    5. Retourne la liste

  SÃ©curitÃ© des messages :
    Les messages sont cherchÃ©s UNIQUEMENT dans les conversations auxquelles
    l'utilisateur participe (WHERE c.participant_1 = ? OR c.participant_2 = ?).


--- 9.6 Classe SearchResult ---

  Chaque rÃ©sultat est reprÃ©sentÃ© de maniÃ¨re uniforme :
    - type     : "POST", "MESSAGE", "EVENT", "GROUP", "BLOG"
    - id       : ID de l'entitÃ© en base
    - title    : titre ou extrait du contenu
    - excerpt  : 100 premiers caractÃ¨res (pour l'aperÃ§u)
    - author   : nom de l'auteur
    - date     : date de crÃ©ation (LocalDateTime)


================================================================================
  10. MÃ‰TIER AVANCÃ‰ 5 â€” DASHBOARD STATISTIQUES (RÃ”LE-BASED)
================================================================================

  Fichier : src/main/java/com/skilora/community/service/DashboardStatsService.java
  Taille  : 246 lignes


--- 10.1 RÃ´le ---

  Le DashboardStatsService fournit des statistiques personnalisÃ©es selon le
  rÃ´le de l'utilisateur connectÃ©. Chaque rÃ´le (Admin, Employeur, Utilisateur)
  voit des donnÃ©es diffÃ©rentes sur son tableau de bord.


--- 10.2 Statistiques par rÃ´le ---

  ADMIN :
    - getTotalUsers()            : nombre total d'utilisateurs inscrits
    - getNewUsersThisMonth()     : nouveaux inscrits ce mois-ci
    - getTotalActiveOffers()     : offres d'emploi actives
    - getOpenTickets()           : tickets support ouverts
    - getTotalPayrollThisMonth() : masse salariale du mois (module finance)

  EMPLOYER :
    - getOfferViewsForEmployer(id)    : nombre de vues sur ses offres
    - getApplicationsForEmployer(id)  : candidatures reÃ§ues
    - getInterviewsThisWeek(id)       : entretiens planifiÃ©s cette semaine

  USER :
    - getUserApplicationCount(id)      : total de mes candidatures
    - getUserActiveApplications(id)    : candidatures en cours (non rejetÃ©es)
    - getUserEnrollmentCount(id)       : formations auxquelles je suis inscrit
    - getUserConnectionCount(id)       : nombre de connexions acceptÃ©es


--- 10.3 Fil d'activitÃ© rÃ©cente ---

  MÃ©thode : getRecentActivity(User user, int limit)

  Retourne un fil d'activitÃ© personnalisÃ© selon le rÃ´le :

  ADMIN â†’ DerniÃ¨res connexions d'utilisateurs + tickets ouverts
    SQL : SELECT 'LOGIN', full_name, last_login FROM users ORDER BY last_login DESC

  EMPLOYER â†’ DerniÃ¨res candidatures reÃ§ues sur ses offres
    SQL : SELECT 'APPLICATION', u.full_name, a.applied_date FROM applications a ...

  USER â†’ Mes candidatures + mes inscriptions formations
    SQL : SELECT 'APPLICATION', o.title, a.applied_date FROM applications a ...


--- 10.4 Classe ActivityItem ---

  Chaque activitÃ© rÃ©cente est reprÃ©sentÃ©e par :
    - type        : "LOGIN", "APPLICATION", "ENROLLMENT", "TICKET"
    - description : texte descriptif ("Jean Dupont a postulÃ© Ã ...")
    - time        : date/heure de l'activitÃ© (LocalDateTime)


================================================================================
  11. RÃ‰CAPITULATIF â€” OÃ™ TROUVER CHAQUE BLOC DE CODE
================================================================================


--- 11.1 APIs externes ---

  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘ API                   â•‘ Fichier                              â•‘ MÃ©thodes clÃ©s (lignes)            â•‘
  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  â•‘                       â•‘                                      â•‘ translate() â†’ ligne 213           â•‘
  â•‘ MyMemory              â•‘ service/TranslationService.java      â•‘ callMyMemoryAPI() â†’ ligne 335     â•‘
  â•‘ (Traduction)          â•‘ (604 lignes)                         â•‘ detectLanguage() â†’ ligne 454      â•‘
  â•‘                       â•‘                                      â•‘ isValidTranslation() â†’ ligne 558  â•‘
  â•‘                       â•‘                                      â•‘ stripEmojis() â†’ ligne 436         â•‘
  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  â•‘                       â•‘                                      â•‘ uploadImage() â†’ ligne 120         â•‘
  â•‘ Cloudinary            â•‘ service/CloudinaryUploadService.java â•‘ saveLocally() â†’ ligne 244         â•‘
  â•‘ (Upload images)       â•‘ (318 lignes)                         â•‘ isAllowedExtension() â†’ ligne 280  â•‘
  â•‘                       â•‘                                      â•‘ getContentType() â†’ ligne 296      â•‘
  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  â•‘                       â•‘                                      â•‘ sendOtpEmail() â†’ ligne 60         â•‘
  â•‘ Gmail SMTP            â•‘ service/EmailService.java            â•‘ sendEmail() â†’ ligne 77            â•‘
  â•‘ (Email OTP)           â•‘ (174 lignes)                         â•‘ buildOtpEmailBody() â†’ ligne 118   â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  ContrÃ´leur (CommunityController.java, 3 372 lignes) :
    - Traduction : bouton ligne 721, menu ligne 2988, appel ligne 3048
    - Cloudinary : bouton ligne 316, upload ligne 331
    - Email      : appelÃ© depuis le module User (rÃ©cupÃ©ration mot de passe)


--- 11.2 MÃ©tiers avancÃ©s ---

  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘ MÃ©tier                â•‘ Fichier                                  â•‘ MÃ©thodes clÃ©s                     â•‘
  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  â•‘                       â•‘                                          â•‘ Regex â†’ ligne 51                  â•‘
  â•‘ Mentions @user        â•‘ service/MentionService.java              â•‘ searchUsers() â†’ ligne 104         â•‘
  â•‘                       â•‘ (250 lignes)                             â•‘ extractMentions() â†’ ligne 148     â•‘
  â•‘                       â•‘                                          â•‘ processMentions() â†’ ligne 205     â•‘
  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  â•‘                       â•‘                                          â•‘ Constructeur â†’ ligne 62           â•‘
  â•‘ Notifications         â•‘ service/CommunityNotificationService.javaâ•‘ start()/stop() â†’ lignes 102/112   â•‘
  â•‘ temps rÃ©el            â•‘ (194 lignes)                             â•‘ pollNotifications() â†’ ligne 155   â•‘
  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  â•‘ DÃ©tection             â•‘ service/TranslationService.java          â•‘ detectLanguage() â†’ ligne 454      â•‘
  â•‘ de langue             â•‘ (mÃªme fichier que traduction)            â•‘ 6 Ã©tapes â†’ lignes 460-541         â•‘
  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  â•‘ Recherche             â•‘ service/SearchService.java               â•‘ search() â†’ mÃ©thode principale     â•‘
  â•‘ globale               â•‘ (299 lignes)                             â•‘ SearchResult, SearchFilter, etc.  â•‘
  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  â•‘ Dashboard             â•‘ service/DashboardStatsService.java       â•‘ getTotalUsers(), etc. (Admin)     â•‘
  â•‘ statistiques          â•‘ (246 lignes)                             â•‘ getRecentActivity() (tous rÃ´les)  â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  ContrÃ´leur (CommunityController.java) :
    - Mentions     : autocomplÃ©tion ligne 3127, traitement ligne 413
    - Notifications: initialisation ligne 129, callbacks lignes 141-175
    - DÃ©tection    : appel ligne 3004
    - Recherche    : barre de recherche dans l'onglet Feed
    - Dashboard    : appelÃ© depuis le Dashboard principal


--- 11.3 Patterns techniques utilisÃ©s ---

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Pattern                              â”‚ OÃ¹                              â”‚ Pourquoi                 â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Singleton (Double-Checked Locking)   â”‚ Tous les 15 services            â”‚ 1 instance, thread-safe  â”‚
  â”‚ Cache LRU (LinkedHashMap)            â”‚ TranslationService              â”‚ Ã‰viter appels redondants â”‚
  â”‚ CompletableFuture (async)            â”‚ EmailService                    â”‚ Envoi email non-bloquant â”‚
  â”‚ Timeline + Platform.runLater         â”‚ CommunityNotificationService    â”‚ Polling sans bloquer UI  â”‚
  â”‚ Thread + Platform.runLater           â”‚ Traduction, Upload, Mentions    â”‚ RÃ©seau sans bloquer UI   â”‚
  â”‚ Regex (Pattern/Matcher)              â”‚ MentionService                  â”‚ Extraction des @mentions â”‚
  â”‚ Multipart/form-data                  â”‚ CloudinaryUploadService         â”‚ Upload fichier binaire   â”‚
  â”‚ Fallback pattern                     â”‚ Cloudinary (local), Translation â”‚ RÃ©silience rÃ©seau        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================

  Skilora â€” Documentation technique API et MÃ©tiers AvancÃ©s
  Module CommunautÃ© (Module 6) â€” FÃ©vrier 2026
  JavaFX 21 + MySQL + MyMemory + Cloudinary + Gmail SMTP

================================================================================
